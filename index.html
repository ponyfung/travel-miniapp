<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æˆ‘çš„æ—…è¡Œ App</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --primary: #007aff;
            --bg-glass: rgba(255, 255, 255, 0.75);
            --blur: saturate(180%) blur(20px);
            --radius: 20px;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --danger: #ff3b30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            background-image: var(--bg-image, url('https://images.unsplash.com/photo-1552560229-f2125c064664?q=80&w=1000&auto=format&fit=crop'));
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-main);
            height: 100vh; padding-bottom: 100px; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- ç»ç’ƒæ“¬æ…‹å¡ç‰‡ --- */
        .glass-card {
            background: var(--bg-glass);
            -webkit-backdrop-filter: var(--blur);
            backdrop-filter: var(--blur);
            border-radius: var(--radius);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 15px; padding: 20px;
        }

        /* --- é ‚éƒ¨ Header --- */
        .header-area {
            padding: 20px 20px 0 20px;
            padding-top: env(safe-area-inset-top, 20px);
        }
        .top-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        
        .app-title-box { display: flex; align-items: center; gap: 8px; }
        .app-title { font-size: 26px; font-weight: 800; text-shadow: 0 2px 10px rgba(255,255,255,0.5); }
        .edit-bg-btn { opacity: 0.6; padding: 5px; cursor: pointer; background: rgba(255,255,255,0.5); border-radius: 50%; }

        /* --- é é¢åˆ‡æ›æ§åˆ¶ --- */
        .page-section { display: none; padding: 0 20px; animation: fadeIn 0.3s ease; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === æ—¥å­å°è¦½åˆ— (åªåœ¨è¡Œç¨‹é é¡¯ç¤º) === */
        .day-nav {
            display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px;
            scrollbar-width: none; margin-bottom: 10px;
        }
        .day-nav::-webkit-scrollbar { display: none; }
        
        .day-btn {
            min-width: 65px; height: 70px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: all 0.2s; position: relative;
        }
        .day-btn.active { background: #3a61b0; color: white; box-shadow: 0 4px 15px rgba(58, 97, 176, 0.4); }
        .day-label { font-size: 11px; opacity: 0.8; margin-bottom: 2px; }
        .day-date { font-size: 22px; font-weight: 700; }
        .edit-day-hint { position: absolute; top: 2px; right: 2px; font-size: 8px; opacity: 0.5; }

        /* === è¡Œç¨‹å¡ç‰‡ === */
        .flight-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white; padding: 20px; border-radius: 20px; position: relative; margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);
        }
        .flight-route { display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
        .route-code { font-size: 32px; font-weight: 800; }
        .timeline-card { display: flex; align-items: flex-start; position: relative; }
        .time-box { font-weight: 700; font-size: 16px; color: #3a61b0; width: 50px; flex-shrink: 0; padding-top: 4px; }
        .content-box { flex: 1; }

        /* === è³¼ç‰©æ¸…å–® === */
        .check-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .check-circle { 
            width: 22px; height: 22px; border-radius: 50%; border: 2px solid #ccc; margin-right: 12px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .check-item.done .check-circle { background: var(--primary); border-color: var(--primary); }
        .check-item.done .check-circle::after { content: 'âœ“'; color: white; font-size: 14px; }
        .check-item.done span { text-decoration: line-through; opacity: 0.5; }
        .trash-btn { margin-left: auto; color: var(--danger); opacity: 0.6; padding: 5px; }

        /* === è¨˜å¸³ === */
        .money-display { text-align: center; padding: 20px 0; }
        .total-amount { font-size: 36px; font-weight: 700; color: #3a61b0; margin: 5px 0; }
        .expense-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed rgba(0,0,0,0.1); }

        /* === åº•éƒ¨å°è¦½åˆ— === */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-around;
            padding: 10px 0 25px 0; z-index: 999;
        }
        .nav-btn { text-align: center; color: #999; flex: 1; font-size: 10px; transition: 0.2s; }
        .nav-btn i { display: block; font-size: 24px; margin-bottom: 2px; }
        .nav-btn.active { color: var(--primary); transform: translateY(-2px); }

        /* === å½ˆçª— (Modal) === */
        .modal-wrap {
            position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-wrap.show { display: flex; animation: popUp 0.2s; }
        @keyframes popUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-box { background: white; width: 80%; max-width: 320px; padding: 25px; border-radius: 20px; }
        .modal-input { width: 100%; padding: 10px; margin: 10px 0; background: #f5f5f7; border: none; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-gray { background: #f2f2f7; color: #333; }

        /* éš±è—å…ƒç´  */
        #bg-file, #import-file { display: none; }
        .add-fab { 
            position: fixed; bottom: 90px; right: 20px; 
            background: var(--primary); color: white; width: 50px; height: 50px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 24px; box-shadow: 0 4px 15px rgba(0,122,255,0.4); cursor: pointer;
            z-index: 900;
        }
    </style>
</head>
<body>

    <input type="file" id="bg-file" accept="image/*">

    <div class="header-area">
        <div class="top-row">
            <div class="app-title-box">
                <div class="app-title" id="app-title-text" onclick="editAppTitle()">eMenu Tokyo</div>
                <div class="edit-bg-btn" onclick="document.getElementById('bg-file').click()">
                    <i class="ri-image-edit-line"></i>
                </div>
            </div>
            <div style="text-align:right; font-size:12px; color:var(--text-sub);">
                åŒ¯ç‡: 0.052<br>ä»Šæ—¥: <span id="today-date">--/--</span>
            </div>
        </div>

        <div class="day-nav" id="day-nav-container">
            </div>
    </div>

    <div id="page-trip" class="page-section active">
        <div id="trip-content">
            </div>
        <div class="add-fab" onclick="openAddModal('trip')">ï¼‹</div>
    </div>

    <div id="page-map" class="page-section">
        <div class="glass-card">
            <h3>ğŸ“ åœ°é»å°èˆª</h3>
            <p style="color:#666; font-size:14px;">é»æ“Šç›´æ¥é–‹å•Ÿ Google Maps</p>
            <div style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                <button class="btn btn-gray" onclick="window.open('https://www.google.com/maps/search/?api=1&query=æ±äº¬æˆç”°æ©Ÿå ´')">âœˆï¸ æˆç”°æ©Ÿå ´</button>
                <button class="btn btn-gray" onclick="window.open('https://www.google.com/maps/search/?api=1&query=æ–°å®¿å“¥å‰æ‹‰é£¯åº—')">ğŸ¨ æ–°å®¿å“¥å‰æ‹‰é£¯åº—</button>
                <button class="btn btn-gray" onclick="window.open('https://www.google.com/maps/search/?api=1&query=æ±äº¬éµå¡”')">ğŸ—¼ æ±äº¬éµå¡”</button>
                <button class="btn btn-gray" onclick="window.open('https://www.google.com/maps/search/?api=1&query=å¯Œå£«å±±æ²³å£æ¹–')">ğŸ—» æ²³å£æ¹–</button>
            </div>
        </div>
    </div>

    <div id="page-money" class="page-section">
        <div class="glass-card money-display">
            <div style="font-size:14px; color:#666;">ç¸½æ”¯å‡º (JPY)</div>
            <div class="total-amount" id="money-total">Â¥0</div>
        </div>
        <div class="glass-card">
            <h3>ğŸ“ æ”¯å‡ºç´€éŒ„</h3>
            <div id="expense-list"></div>
        </div>
        <div class="add-fab" onclick="openAddModal('money')">ï¼‹</div>
    </div>

    <div id="page-shop" class="page-section">
        <div class="glass-card">
            <h3>ğŸ›ï¸ å¾…è²·æ¸…å–®</h3>
            <div id="shop-list"></div>
        </div>
        <div class="add-fab" onclick="openAddModal('shop')">ï¼‹</div>
    </div>

    <div id="page-info" class="page-section">
        <div class="glass-card">
            <h3>âš™ï¸ è¨­å®š</h3>
            <div class="check-item" onclick="editAppTitle()">
                <span>ğŸ·ï¸ ä¿®æ”¹ App æ¨™é¡Œ</span>
            </div>
            <div class="check-item" onclick="resetAllData()">
                <span style="color:var(--danger);">âš ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</span>
            </div>
        </div>
        <div class="glass-card">
            <h3>â„¹ï¸ é—œæ–¼</h3>
            <p>é€™æ˜¯ä¸€å€‹ç´”ç¶²é ç‰ˆ Appï¼Œè³‡æ–™å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ä¸­ã€‚</p>
            <p style="color:var(--danger); font-weight:bold;">è«‹å‹¿ä½¿ç”¨ç„¡ç—•æ¨¡å¼ï¼Œå¦å‰‡è³‡æ–™æœƒæ¶ˆå¤±ã€‚</p>
        </div>
    </div>


    <div class="bottom-bar">
        <div class="nav-btn active" onclick="switchPage('trip', this)">
            <i class="ri-calendar-todo-fill"></i> è¡Œç¨‹
        </div>
        <div class="nav-btn" onclick="switchPage('map', this)">
            <i class="ri-map-2-line"></i> åœ°åœ–
        </div>
        <div class="nav-btn" onclick="switchPage('money', this)">
            <i class="ri-wallet-3-line"></i> è¨˜å¸³
        </div>
        <div class="nav-btn" onclick="switchPage('shop', this)">
            <i class="ri-shopping-bag-3-line"></i> è³¼ç‰©
        </div>
        <div class="nav-btn" onclick="switchPage('info', this)">
            <i class="ri-settings-4-line"></i> è³‡è¨Š
        </div>
    </div>

    <div class="modal-wrap" id="main-modal">
        <div class="modal-box">
            <h3 id="modal-title">ç·¨è¼¯</h3>
            <div id="modal-content"></div>
            <div class="btn-row">
                <button class="btn btn-gray" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="modal-save-btn">å„²å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // === æ ¸å¿ƒè³‡æ–™ ===
        let appData = {
            title: "eMenu Tokyo",
            currentDayIdx: 0,
            days: [
                { dateStr: "08", fullDate: "Day 1", events: [
                    { id: 1, type: 'flight', time: '09:05', title: 'å‰å¾€æ±äº¬', sub: 'HKG -> TYO' },
                    { id: 2, type: 'norm', time: '15:00', title: 'NEX æˆç”°ç‰¹å¿«', sub: 'å‰å¾€æ–°å®¿' }
                ]},
                { dateStr: "09", fullDate: "Day 2", events: [] },
                { dateStr: "10", fullDate: "Day 3", events: [] },
                { dateStr: "11", fullDate: "Day 4", events: [] }
            ],
            expenses: [],
            shopList: [
                { id: 1, text: "EVE æ­¢ç—›è—¥", done: false },
                { id: 2, text: "NewYork Cheese", done: false }
            ]
        };

        // === åˆå§‹åŒ– ===
        function init() {
            const saved = localStorage.getItem('myTravelApp_v4');
            if (saved) appData = JSON.parse(saved);
            
            const savedBg = localStorage.getItem('myTravelBg');
            if (savedBg) document.body.style.backgroundImage = `url(${savedBg})`;

            document.getElementById('app-title-text').innerText = appData.title;
            const today = new Date();
            document.getElementById('today-date').innerText = `${today.getMonth()+1}/${today.getDate()}`;

            renderDays();
            renderTrip();
            renderMoney();
            renderShop();
        }

        function save() {
            localStorage.setItem('myTravelApp_v4', JSON.stringify(appData));
        }

        // === é é¢åˆ‡æ› ===
        function switchPage(pageId, btn) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            // å¦‚æœä¸æ˜¯ Trip é é¢ï¼Œéš±è—æ—¥å­é¸å–®ä»¥ç¯€çœç©ºé–“
            document.getElementById('day-nav-container').style.display = (pageId === 'trip') ? 'flex' : 'none';
            // éš±è—/é¡¯ç¤ºæ–°å¢æŒ‰éˆ•
            document.querySelectorAll('.add-fab').forEach(el => el.style.display = 'none');
            if(pageId === 'trip' || pageId === 'money' || pageId === 'shop') {
                document.querySelector(`#page-${pageId} .add-fab`).style.display = 'flex';
            }
        }

        // === è¡Œç¨‹é‚è¼¯ ===
        function renderDays() {
            const nav = document.getElementById('day-nav-container');
            nav.innerHTML = '';
            appData.days.forEach((day, idx) => {
                const btn = document.createElement('div');
                btn.className = `day-btn ${idx === appData.currentDayIdx ? 'active' : ''}`;
                btn.innerHTML = `
                    <span class="day-label">${day.fullDate}</span>
                    <span class="day-date">${day.dateStr}</span>
                `;
                btn.onclick = () => {
                    if(appData.currentDayIdx === idx) {
                        editDayInfo(idx); // å†æ¬¡é»æ“Šç·¨è¼¯æ—¥æœŸ
                    } else {
                        appData.currentDayIdx = idx;
                        renderDays();
                        renderTrip();
                        save();
                    }
                };
                nav.appendChild(btn);
            });
        }

        function renderTrip() {
            const list = document.getElementById('trip-content');
            list.innerHTML = '';
            const dayEvents = appData.days[appData.currentDayIdx].events;

            if(dayEvents.length === 0) list.innerHTML = '<div style="text-align:center; opacity:0.5; margin-top:50px;">æœ¬æ—¥ç„¡è¡Œç¨‹</div>';

            dayEvents.sort((a,b) => a.time.localeCompare(b.time)); // æ’åº

            dayEvents.forEach((ev, idx) => {
                const div = document.createElement('div');
                div.className = 'glass-card ' + (ev.type === 'flight' ? 'flight-card' : 'timeline-card');
                
                let html = '';
                if(ev.type === 'flight') {
                    html = `
                        <div style="font-size:12px; opacity:0.8;">FLIGHT â€¢ ${ev.time}</div>
                        <div class="flight-route">
                            <span class="route-code">${ev.sub.split('->')[0] || 'HKG'}</span>
                            <i class="ri-plane-fill" style="font-size:24px;"></i>
                            <span class="route-code">${ev.sub.split('->')[1] || 'TYO'}</span>
                        </div>
                        <div style="font-weight:bold;">${ev.title}</div>
                    `;
                } else {
                    html = `
                        <div class="time-box">${ev.time}</div>
                        <div class="content-box">
                            <div style="font-weight:bold; font-size:18px;">${ev.title}</div>
                            <div style="color:#666; font-size:14px; margin-top:4px;">${ev.sub}</div>
                        </div>
                        <i class="ri-close-circle-line" onclick="deleteEvent(${idx})" style="color:var(--danger); opacity:0.5;"></i>
                    `;
                }
                div.innerHTML = html;
                // é»æ“Šç·¨è¼¯
                if(ev.type !== 'flight') {
                    // ç‚ºäº†ç°¡åŒ–ï¼Œé€™è£¡åªåšåˆªé™¤ï¼Œæˆ–æ˜¯é›™æ“Šç·¨è¼¯ï¼Œé€™è£¡å…ˆç°¡å–®è™•ç†
                }
                list.appendChild(div);
            });
        }

        function editDayInfo(idx) {
            const day = appData.days[idx];
            const newLabel = prompt("è¼¸å…¥æ¨™ç±¤ (ä¾‹å¦‚: Day 1 æˆ– æ±äº¬)", day.fullDate);
            const newDate = prompt("è¼¸å…¥æ—¥æœŸ (ä¾‹å¦‚: 08)", day.dateStr);
            if(newLabel && newDate) {
                day.fullDate = newLabel;
                day.dateStr = newDate;
                renderDays();
                save();
            }
        }

        function deleteEvent(idx) {
            if(confirm('åˆªé™¤æ­¤è¡Œç¨‹?')) {
                appData.days[appData.currentDayIdx].events.splice(idx, 1);
                renderTrip();
                save();
            }
        }

        // === è¨˜å¸³é‚è¼¯ ===
        function renderMoney() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            let total = 0;
            appData.expenses.forEach((ex, idx) => {
                total += parseInt(ex.amount);
                list.innerHTML += `
                    <div class="expense-row">
                        <span>${ex.item}</span>
                        <div style="display:flex; gap:10px;">
                            <span style="font-weight:bold;">Â¥${ex.amount}</span>
                            <i class="ri-delete-bin-line" onclick="deleteMoney(${idx})" style="color:var(--danger); font-size:14px;"></i>
                        </div>
                    </div>
                `;
            });
            document.getElementById('money-total').innerText = 'Â¥' + total;
        }

        function deleteMoney(idx) {
            appData.expenses.splice(idx, 1);
            renderMoney(); save();
        }

        // === è³¼ç‰©é‚è¼¯ ===
        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = '';
            appData.shopList.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = `check-item ${item.done ? 'done' : ''}`;
                div.innerHTML = `
                    <div class="check-circle" onclick="toggleShop(${idx})"></div>
                    <span style="flex:1;">${item.text}</span>
                    <i class="ri-delete-bin-line trash-btn" onclick="deleteShop(${idx})"></i>
                `;
                list.appendChild(div);
            });
        }
        function toggleShop(idx) {
            appData.shopList[idx].done = !appData.shopList[idx].done;
            renderShop(); save();
        }
        function deleteShop(idx) {
            appData.shopList.splice(idx, 1);
            renderShop(); save();
        }

        // === å½ˆçª—èˆ‡æ–°å¢é‚è¼¯ ===
        const modal = document.getElementById('main-modal');
        let currentAddType = '';

        function openAddModal(type) {
            currentAddType = type;
            const content = document.getElementById('modal-content');
            document.getElementById('modal-title').innerText = 
                type === 'trip' ? 'æ–°å¢è¡Œç¨‹' : (type === 'money' ? 'è¨˜ä¸€ç­†' : 'æ–°å¢è³¼ç‰©');
            
            if(type === 'trip') {
                content.innerHTML = `
                    <input type="time" id="inp-time" class="modal-input" value="12:00">
                    <input type="text" id="inp-title" class="modal-input" placeholder="æ¨™é¡Œ (ä¾‹: åƒæ‹‰éºµ)">
                    <input type="text" id="inp-sub" class="modal-input" placeholder="å‚™è¨»/åœ°é»">
                `;
            } else if(type === 'money') {
                content.innerHTML = `
                    <input type="text" id="inp-item" class="modal-input" placeholder="é …ç›® (ä¾‹: é£²æ–™)">
                    <input type="number" id="inp-amount" class="modal-input" placeholder="é‡‘é¡ (æ—¥åœ“)">
                `;
            } else {
                content.innerHTML = `
                    <input type="text" id="inp-shop" class="modal-input" placeholder="å•†å“åç¨±">
                `;
            }
            modal.classList.add('show');
            
            document.getElementById('modal-save-btn').onclick = () => {
                if(type === 'trip') {
                    appData.days[appData.currentDayIdx].events.push({
                        id: Date.now(), type: 'norm',
                        time: document.getElementById('inp-time').value,
                        title: document.getElementById('inp-title').value,
                        sub: document.getElementById('inp-sub').value
                    });
                    renderTrip();
                } else if(type === 'money') {
                    appData.expenses.push({
                        item: document.getElementById('inp-item').value,
                        amount: document.getElementById('inp-amount').value
                    });
                    renderMoney();
                } else {
                    appData.shopList.push({
                        id: Date.now(), text: document.getElementById('inp-shop').value, done: false
                    });
                    renderShop();
                }
                save();
                closeModal();
            };
        }

        function closeModal() { modal.classList.remove('show'); }

        // === é›œé …åŠŸèƒ½ ===
        function editAppTitle() {
            const newT = prompt("ä¿®æ”¹ App æ¨™é¡Œ", appData.title);
            if(newT) {
                appData.title = newT;
                document.getElementById('app-title-text').innerText = newT;
                save();
            }
        }

        document.getElementById('bg-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) {
                document.body.style.backgroundImage = `url(${evt.target.result})`;
                try {
                    localStorage.setItem('myTravelBg', evt.target.result);
                } catch(e) { alert("åœ–ç‰‡å¤ªå¤§ç„¡æ³•å„²å­˜ï¼Œä½†æœ¬æ¬¡ç€è¦½æœ‰æ•ˆ"); }
            };
            reader.readAsDataURL(file);
        });

        function resetAllData() {
            if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è³‡æ–™ä¸¦é‡ç½®å—ï¼Ÿ")) {
                localStorage.removeItem('myTravelApp_v4');
                localStorage.removeItem('myTravelBg');
                location.reload();
            }
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>